<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<title>Redirecting...</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f6f7fb;
  text-align: center;
  padding-top: 60px;
}
.box {
  background: white;
  padding: 25px;
  max-width: 520px;
  margin: auto;
  border-radius: 12px;
  box-shadow: 0 10px 20px rgba(0,0,0,.08);
}
.error {
  color: red;
  font-weight: bold;
}
</style>
</head>

<body>
<div class="box">
  <h2 id="status">üîÑ ƒêang x·ª≠ l√Ω link...</h2>
  <p id="msg"></p>
</div>

<script>
const JSON_URL = "https://huyquochoc.github.io/Quiz/shortlinks.json";

const params = new URLSearchParams(window.location.search);
const key = params.get("id");

const statusEl = document.getElementById("status");
const msgEl = document.getElementById("msg");

if (!key) {
  statusEl.textContent = "‚ùå Thi·∫øu m√£ link";
  msgEl.textContent = "Kh√¥ng t√¨m th·∫•y tham s·ªë ?id=";
  throw new Error("Missing id");
}

fetch(JSON_URL)
  .then(r => r.json())
  .then(data => {
    if (!data[key]) {
      statusEl.textContent = "‚ùå Link kh√¥ng t·ªìn t·∫°i";
      msgEl.textContent = "M√£ link kh√¥ng h·ª£p l·ªá ho·∫∑c ƒë√£ b·ªã x√≥a";
      return;
    }

    const record = data[key];
    const url = record.url;
    const expire = record.expire;

    // ===== CHECK EXPIRE =====
    if (expire) {
      const today = new Date().toISOString().split("T")[0];
      if (today > expire) {
        statusEl.textContent = "‚õî Link ƒë√£ h·∫øt h·∫°n";
        msgEl.textContent = "Vui l√≤ng li√™n h·ªá gi√°o vi√™n ƒë·ªÉ l·∫•y link m·ªõi";
        return;
      }
    }

    // ===== REDIRECT =====
    statusEl.textContent = "‚úÖ ƒêang chuy·ªÉn h∆∞·ªõng...";
    msgEl.textContent = "Vui l√≤ng ch·ªù...";

    setTimeout(() => {
      window.location.href = url;
    }, 800);
  })
  .catch(err => {
    console.error(err);
    statusEl.textContent = "‚ö†Ô∏è L·ªói t·∫£i d·ªØ li·ªáu";
    msgEl.textContent = "Kh√¥ng th·ªÉ t·∫£i shortlinks.json";
  });
</script>
</body>
</html>
